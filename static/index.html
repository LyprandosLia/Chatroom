<!DOCTYPE html>
<html>
<head>
    <title>Cafe Chat</title>
</head>
<body>
    <h1>FastAPI Chat</h1>
    <div id="chat" style="border:1px solid #ccc; padding:10px; height:300px; overflow:auto;"></div>
    <input type="text" id="messageInput" placeholder="Type your message">
    <button onclick="sendMessage()">Send</button>

    <script>
        const username = prompt("Enter your username:");
        const ws = new WebSocket("ws://localhost:8000/ws");
        const chat = document.getElementById("chat");
        const input = document.getElementById("messageInput");

        ws.onopen = () => {
            console.log("âœ… Connected to server");
            ws.send(username); // Î£Ï„Î­Î»Î½Î¿Ï…Î¼Îµ Ï„Î¿ username ÏƒÏ„Î¿Î½ server
        };

        ws.onmessage = (event) => {
            console.log("ğŸ“© Received:", event.data);
            const msg = document.createElement("p");

            // Î‘Î½ Ï„Î¿ Î¼Î®Î½Ï…Î¼Î± Î­Ï‡ÎµÎ¹ format "username:message"
            if(event.data.includes(":")){
                const [sender, message] = event.data.split(":", 2);

                if(sender === username){
                    msg.textContent = "Send: " + message;
                    msg.style.color = "blue";
                } else {
                    msg.textContent =  `(${sender}): ${message}`;
                    msg.style.color = "black";
                }
            } else {
                // Ï€.Ï‡. "âœ… User connected"
                msg.textContent = event.data;
                msg.style.fontStyle = "italic";
            }

            chat.appendChild(msg);
            chat.scrollTop = chat.scrollHeight; // auto scroll
        };

        ws.onerror = (err) => {
            console.error("âŒ WebSocket error:", err);
        };

        function sendMessage() {
            if(input.value.trim() !== ""){
                ws.send(input.value);
                input.value = "";
            }
        }

        // Î£Ï„Î­Î»Î½Î¿Ï…Î¼Îµ Î¼Î®Î½Ï…Î¼Î± Î¼Îµ Enter
        input.addEventListener("keypress", (e) => {
            if(e.key === "Enter") sendMessage();
        });
    </script>
</body>
</html>
